# Portainer

## Overview
Portainer is a lightweight management UI which allows you to easily manage your Docker environments (Docker hosts or Swarm clusters). It provides a simple, yet powerful interface for managing Docker containers, images, networks, and volumes.

## Purpose
In the Homelab Management System, Portainer serves as the central management interface for all Docker services. It simplifies the deployment, management, and monitoring of containerized applications, making it easier to handle complex setups and configurations.

## Authentication
Portainer requires a few steps to setup with and OIDC Provider(e.g. Authentik). This repository utilizes Authentik for centralized user management. Please follow [this documention](https://integrations.goauthentik.io/hypervisors-orchestrators/portainer/) for setting up Authentik with Portainer.

### Requirements for Authentik Integration
- Authentik deployed with an admin account(or user with admin rights).
- Portainer running with an admin account

### Notes
All services are accessible through a domain name setup in Pihole with Tailscale SplitDNS. These domain names resolve to the host machines Tailnet IP which caddy is listening to. 

All authorization urls provided by Authentik use these domain names with HTTPS. Therefore, to properly resolve these urls to a valid IP you will need to have a proper DNS setup within the portainer environment to resolve to the Caddy reverse proxy docker IP.

The second problem here is after the IP is successfully resolving. Portainer then needs to trust the SSL certificate automatically generated by Caddy. Therefore, you will need to run the following commands:\
1. Copy the Portainer ca-certificates.crt into a portainer/certs directory
```bash
cd portainer
mkdir certs
docker cp portainer:/etc/ssl/certs/ca-certificates.crt ./certs
```
2. Copy the Caddy CA Certificate to certs/
```bash
cd portainer
docker cp caddy:/data/caddy/pki/authorities/local/root.crt ./certs/caddy_root_ca.crt
```
3. Append caddy_root_ca.crt contents to ca-certificates.crt
4. Create a docker volume replacing portainer ca-certificates.crt
```yaml
portainer:
    ...
    volumes:
        ...
        - ./certs:/etc/ssl/certs/
```